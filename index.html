<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ì²œFC1995 ê³µì‹ê²½ê¸° í†µì‚°ê¸°ë¡ ì¡°íšŒ ì‚¬ì´íŠ¸</title>
    <style>
        /* [ì„±í˜„ë‹˜ì˜ ìŠ¤íƒ€ì¼ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤] */
        :root { --bfc-red: #ed1c24; --bfc-black: #1a1a1a; --bg-gray: #f4f4f4; }
        body { font-family: 'Pretendard', sans-serif; margin: 0; background-color: var(--bg-gray); color: #333; display: flex; flex-direction: column; min-height: 100vh; }
        header { background: linear-gradient(135deg, var(--bfc-black) 60%, var(--bfc-red)); color: white; padding: 40px 20px 60px; text-align: center; border-bottom: 6px solid var(--bfc-red); position: relative; }
        .home-link { text-decoration: none; color: white; display: inline-flex; align-items: center; gap: 10px; transition: 0.2s; cursor: pointer; }
        .home-link:hover { opacity: 0.8; transform: scale(1.02); }
        header h1 { margin: 0; font-size: 1.8rem; font-weight: 900; }
        .current-date { margin-top: 10px; font-size: 0.9rem; opacity: 0.7; }
        .stats-dashboard { background: rgba(255, 255, 255, 0.1); margin: 20px auto 0; padding: 12px 25px; border-radius: 50px; display: inline-block; backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.2); font-size: 0.9rem; }
        .stats-dashboard span { margin: 0 8px; font-weight: 600; }
        .stats-emphasis { color: #fff; font-size: 1.1rem; }
        .mode-switch { display: flex; justify-content: center; gap: 10px; margin-top: -25px; position: relative; z-index: 100; }
        .mode-btn { background: white; border: 2px solid var(--bfc-red); color: var(--bfc-red); padding: 12px 30px; border-radius: 50px; font-weight: 800; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .mode-btn.active { background: var(--bfc-red); color: white; }
        .container { max-width: 1300px; margin: 30px auto 50px; padding: 0 15px; flex: 1; position: relative; z-index: 10; }
        .ranking-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 40px; }
        @media (max-width: 1000px) { .ranking-container { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .ranking-container { grid-template-columns: 1fr; } }
        .ranking-box { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-top: 4px solid var(--bfc-black); display: flex; flex-direction: column; }
        .ranking-box h3 { margin: 0 0 15px 0; font-size: 0.95rem; color: var(--bfc-red); }
        .rank-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; font-size: 0.85rem; }
        .btn-more { margin-top: 15px; background: #f8f9fa; border: 1px solid #eee; color: #888; padding: 5px; border-radius: 5px; cursor: pointer; font-size: 0.75rem; transition: 0.2s; text-align: center; font-weight: bold; }
        .btn-more:hover { background: var(--bfc-red); color: white; border-color: var(--bfc-red); }
        .filter-container { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        .filter-item { display: flex; flex-direction: column; gap: 8px; }
        .filter-item label { font-size: 0.85rem; font-weight: bold; color: #666; }
        select, input { padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; outline: none; }
        .checkbox-group { display: flex; gap: 15px; align-items: center; background: #f9f9f9; padding: 10px 15px; border-radius: 10px; border: 1px solid #ddd; }
        .checkbox-item { display: flex; align-items: center; gap: 5px; font-size: 0.85rem; cursor: pointer; }
        .data-notice { margin-top: 20px; padding: 12px 18px; font-size: 0.85rem; color: #777; line-height: 1.6; border-left: 4px solid var(--bfc-red); background: #fff; border-radius: 0 10px 10px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .view-header { margin-top: 20px; background: white; padding: 20px; border-radius: 15px; border-left: 6px solid var(--bfc-red); box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: none; flex-direction: column; gap: 10px; }
        .view-title-row { display: flex; justify-content: space-between; width: 100%; align-items: center; }
        .view-title { font-size: 1.1rem; font-weight: bold; }
        .view-summary { font-size: 0.95rem; color: #555; border-top: 1px dashed #eee; padding-top: 10px; }
        .view-summary span { color: var(--bfc-red); font-weight: bold; }
        .results-box { background: white; border-radius: 15px; margin-top: 15px; overflow-x: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; min-width: 1100px; }
        th { background: #f8f9fa; padding: 15px; font-size: 0.75rem; color: #555; text-align: center; }
        td { padding: 12px; text-align: center; border-bottom: 1px solid #f0f0f0; font-size: 0.85rem; }
        .clickable { color: var(--bfc-black); cursor: pointer; text-decoration: underline; text-decoration-color: #ddd; }
        .clickable:hover { color: var(--bfc-red); text-decoration-color: var(--bfc-red); font-weight: bold; }
        .highlight-red { color: var(--bfc-red); font-weight: bold; }
        .win { color: var(--bfc-red); font-weight: bold; }
        .btn-reset { background: var(--bfc-red); color: white; border: none; padding: 10px 18px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 0.85rem; }
        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 500px; border-radius: 20px; padding: 30px; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        .modal-header { border-bottom: 3px solid var(--bfc-red); padding-bottom: 15px; margin-bottom: 20px; text-align: center; }
        .modal-header h2 { margin: 0; color: var(--bfc-black); font-size: 1.5rem; }
        .modal-body { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .modal-item { background: #f8f9fa; padding: 12px; border-radius: 10px; text-align: center; }
        .modal-item-wide { grid-column: span 2; background: #f8f9fa; padding: 12px; border-radius: 10px; text-align: center; }
        .modal-item label, .modal-item-wide label { display: block; font-size: 0.75rem; color: #777; margin-bottom: 5px; }
        .modal-item span, .modal-item-wide span { font-weight: 800; font-size: 1.1rem; color: var(--bfc-red); }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; cursor: pointer; color: #999; }
        footer { background-color: var(--bfc-black); color: #999; text-align: center; padding: 40px 20px; margin-top: auto; }
        .loading { text-align: center; padding: 100px; font-weight: bold; color: var(--bfc-red); }
    </style>
</head>
<body>

<div id="modal-overlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div class="modal-header"><h2 id="modal-player-name">ì„ ìˆ˜ ì´ë¦„</h2></div>
        <div class="modal-body" id="modal-data"></div>
    </div>
</div>

<header>
    <a href="javascript:void(0)" onclick="resetToAll()" class="home-link">
        <span style="font-size:1.5rem">ğŸ </span>
        <h1>ë¶€ì²œFC1995 ê³µì‹ê²½ê¸° ê¸°ë¡ ì•„ì¹´ì´ë¸Œ</h1>
    </a>
    <div id="today-date" class="current-date"></div>
    <div class="stats-dashboard">
        <span id="stat-total">0ê²½ê¸°</span>
        <span id="stat-w">0ìŠ¹</span><span id="stat-d">0ë¬´</span><span id="stat-l">0íŒ¨</span>
        <span style="opacity:0.3">|</span>
        <span id="stat-gf">0ë“ì </span><span id="stat-ga">0ì‹¤ì </span>
        <span style="opacity:0.3">|</span>
        <span>ì „ì²´ ìŠ¹ë¥  <span class="stats-emphasis" id="stat-rate">0%</span></span>
    </div>
</header>

<div class="mode-switch">
    <button id="mode-t" class="mode-btn active" onclick="switchMode('team')">ğŸŸï¸ íŒ€ ê²½ê¸° ê¸°ë¡</button>
    <button id="mode-p" class="mode-btn" onclick="switchMode('player')">ğŸƒâ€â™‚ï¸ ì„ ìˆ˜ ê°œì¸ ê¸°ë¡</button>
</div>

<div class="container">
    <div id="loader" class="loading">ğŸ”´ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë™ê¸°í™” ì¤‘ì…ë‹ˆë‹¤...</div>
    
    <div id="main-view" style="display:none;">
        <div id="team-section">
            <div class="filter-container">
                <div class="filter-item"><label>ì‹œì¦Œë³„ ì¡°íšŒ</label><select id="select-year" onchange="updateView()"><option value="">ì „ì²´ ì‹œì¦Œ</option></select></div>
                <div class="filter-item"><label>í™ˆ/ì›ì •ê²½ê¸°</label><select id="select-location" onchange="updateView()"><option value="">ì „ì²´</option><option value="home">í™ˆ ê²½ê¸°</option><option value="away">ì›ì • ê²½ê¸°</option></select></div>
                <div class="filter-item"><label>ê°ë…ë³„ ì¡°íšŒ</label><select id="select-manager" onchange="updateView()"><option value="">ëª¨ë“  ê°ë…</option></select></div>
                <div class="filter-item"><label>ëŒ€íšŒë³„ ì¡°íšŒ</label><select id="select-league" onchange="updateView()"><option value="">ëª¨ë“  ëŒ€íšŒ</option></select></div>
            </div>
            <div class="data-notice">ğŸ“Œ <strong>ë°ì´í„° ì•ˆë‚´:</strong> K3ë¦¬ê·¸ ê²°ê³¼ ì¤‘ ê´€ì¤‘ ìˆ˜ê°€ ëˆ„ë½ëœ ê²½ê¸°ì™€ ì½”ë¡œë‚˜19ë¡œ ì¸í•œ ë¬´ê´€ì¤‘ ê²½ê¸°ëŠ” 0ìœ¼ë¡œ í‘œê¸°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</div>
        </div>

        <div id="player-section" style="display: none;">
            <div id="player-main-view">
                <div class="ranking-container">
                    <div class="ranking-box"><h3>ğŸƒâ€â™‚ï¸ í†µì‚° ì¶œì „ TOP 7</h3><div id="rank-match"></div><button class="btn-more" onclick="showAllRankings('match')">more</button></div>
                    <div class="ranking-box"><h3>âš½ í†µì‚° ë“ì  TOP 7</h3><div id="rank-goal"></div><button class="btn-more" onclick="showAllRankings('goal')">more</button></div>
                    <div class="ranking-box"><h3>ğŸ”¥ ê³µê²©í¬ì¸íŠ¸ TOP 7</h3><div id="rank-atpoint"></div><button class="btn-more" onclick="showAllRankings('ap')">more</button></div>
                    <div class="ranking-box"><h3>ğŸ§¤ í´ë¦°ì‹œíŠ¸ TOP 7</h3><div id="rank-cs"></div><button class="btn-more" onclick="showAllRankings('cs')">more</button></div>
                </div>
                <div class="filter-container">
                    <div class="filter-item"><label>ì‹œì¦Œ ì„ íƒ</label><select id="p-select-year" onchange="updateView()"><option value="">ì „ì²´ ì‹œì¦Œ</option></select></div>
                    <div class="filter-item"><label>ì„ ìˆ˜ëª… ê²€ìƒ‰</label><input type="text" id="p-search-name" placeholder="ì´ë¦„ ì…ë ¥" onkeyup="updateView()"></div>
                    <div class="filter-item" style="grid-column: span 2;">
                        <label>ëŒ€íšŒ ì„ íƒ</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item"><input type="checkbox" id="check-all" checked onclick="toggleAllLeagues(this)"> ì „ì²´ ì„ íƒ</label>
                            <label class="checkbox-item"><input type="checkbox" name="p-league" value="Kë¦¬ê·¸1" checked onclick="handleSingleLeagueCheck()"> Kë¦¬ê·¸1</label>
                            <label class="checkbox-item"><input type="checkbox" name="p-league" value="Kë¦¬ê·¸2" checked onclick="handleSingleLeagueCheck()"> Kë¦¬ê·¸2</label>
                            <label class="checkbox-item"><input type="checkbox" name="p-league" value="ì½”ë¦¬ì•„ì»µ" checked onclick="handleSingleLeagueCheck()"> ì½”ë¦¬ì•„ì»µ</label>
                        </div>
                    </div>
                </div>
            </div>
            <div id="player-total-ranking-view" style="display: none;">
                <div class="view-header" style="display: flex;"><div class="view-title-row"><div id="total-rank-title" class="view-title">ğŸ† ë¶€ì²œFC1995 ì—­ëŒ€ í†µì‚° ê¸°ë¡ ìˆœìœ„</div><button class="btn-reset" onclick="exitTotalRanking()">ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button></div></div>
            </div>
            <div class="data-notice">ğŸ“Œ <strong>ë°ì´í„° ì•ˆë‚´:</strong> ì„ ìˆ˜ ê¸°ë¡ì€ 2013ë…„ í”„ë¡œ ì§„ì¶œ ì´í›„ ê³µì‹ ê²½ê¸° ë°ì´í„°ë§Œì„ ë°”íƒ•ìœ¼ë¡œ ì§‘ê³„ë©ë‹ˆë‹¤.</div>
        </div>

        <div id="dynamic-header" class="view-header"><div class="view-title-row"><div id="dynamic-title" class="view-title"></div><button class="btn-reset" onclick="goBack()">ì´ì „ ê²°ê³¼ë¡œ ëŒì•„ê°€ê¸°</button></div><div id="dynamic-summary" class="view-summary"></div></div>

        <div class="results-box"><table><thead id="table-head"></thead><tbody id="table-body"></tbody></table></div>
    </div>
</div>

<footer><center><p>Â© 2026 ë‚¨ì„±í˜„. All Rights Reserved.</p></center></footer>

<script>
    // [ì‹¤ì‹œê°„ ì—°ë™ ì„¤ì •]
    const TEAM_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQTLnO6CTQkcgJTDHr0MNJAA5xUCCWSqWSq-fgvJkEIGRrOBH1D9EXNXJLxIAriWiQ1oMrSKxTq6Y8m/pub?gid=0&single=true&output=csv";
    const PLAYER_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQTLnO6CTQkcgJTDHr0MNJAA5xUCCWSqWSq-fgvJkEIGRrOBH1D9EXNXJLxIAriWiQ1oMrSKxTq6Y8m/pub?gid=1150204300&single=true&output=csv";

    let rawData = [], playerSeasonData = [];
    let sortState = { column: 'date', direction: 'asc' };
    let currentFilter = { opponent: null, stadium: null };
    let historyStack = [];
    let currentMode = 'team';
    let isTotalRankMode = false;

    // [ë°ì´í„° ë¡œë“œ ë¡œì§]
    async function loadData() {
        try {
            const [tRes, pRes] = await Promise.all([
                fetch(TEAM_URL + "&cb=" + Date.now()),
                fetch(PLAYER_URL + "&cb=" + Date.now())
            ]);
            rawData = parseCSV(await tRes.text());
            playerSeasonData = parseCSV(await pRes.text());
            
            document.getElementById('loader').style.display = 'none';
            document.getElementById('main-view').style.display = 'block';
            init(); // ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰
        } catch (e) {
            document.getElementById('loader').innerHTML = "âŒ êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™ ì‹¤íŒ¨. ì‹œíŠ¸ì˜ 'ì›¹ì— ê²Œì‹œ' ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.";
        }
    }

    // [ì„±í˜„ë‹˜ ìš”ì²­ ë°˜ì˜: ê³µë°± ë° ë°ì´í„° ë°€ë¦¼ ë°©ì§€ íŒŒì‹±]
    function parseCSV(text) {
        const lines = text.split(/\r?\n/).filter(l => l.trim());
        if (lines.length < 1) return [];
        const heads = lines[0].split(',').map(h => h.trim().replace(/[^\w]/gi, '').toLowerCase());
        
        return lines.slice(1).map(line => {
            const vals = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || line.split(',');
            let o = {};
            heads.forEach((h, i) => {
                let val = (vals[i] || "").replace(/^"|"$/g, "").trim();
                o[h] = val;
            });
            return o;
        });
    }

    // [ì„±í˜„ë‹˜ì˜ ë‚˜ë¨¸ì§€ ë¡œì§ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤]
    function getUnifiedTeamName(name) {
        if (!name) return "";
        const map = { "ìƒì£¼ ìƒë¬´": "ìƒë¬´ ì¶•êµ¬ë‹¨", "ê¹€ì²œ ìƒë¬´": "ìƒë¬´ ì¶•êµ¬ë‹¨", "ì•„ì‚° ìœ ë‚˜ì´í‹°ë“œ": "ì•„ì‚° ì‹œë¯¼ì¶•êµ¬ë‹¨", "ì œì£¼ SK": "SK ì¶•êµ¬ë‹¨" };
        return map[name] || name;
    }

    function getUnifiedLeagueName(name) {
        if (!name) return "";
        if (name.includes("Kë¦¬ê·¸1")) return "Kë¦¬ê·¸1";
        if (name.includes("Kë¦¬ê·¸2") || name.includes("Kë¦¬ê·¸ ì±Œë¦°ì§€")) return "Kë¦¬ê·¸2";
        if (name.includes("ì½”ë¦¬ì•„ì»µ") || name.includes("FAì»µ")) return "ì½”ë¦¬ì•„ì»µ";
        return name;
    }

    function switchMode(mode) {
        currentMode = mode;
        isTotalRankMode = false;
        historyStack = [];
        currentFilter = { opponent: null, stadium: null };
        document.querySelectorAll('select, input:not([type="checkbox"])').forEach(el => el.value = "");
        document.getElementById('team-section').style.display = mode === 'team' ? 'block' : 'none';
        document.getElementById('player-section').style.display = mode === 'player' ? 'block' : 'none';
        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
        if(mode === 'team') { document.getElementById('mode-t').classList.add('active'); sortState = { column: 'date', direction: 'asc' }; }
        else { document.getElementById('mode-p').classList.add('active'); sortState = { column: 'match', direction: 'desc' }; calculateTotalRankings(); }
        updateView();
    }

    function toggleSort(col) {
        if (sortState.column === col) sortState.direction = sortState.direction === 'asc' ? 'desc' : 'asc';
        else { sortState.column = col; sortState.direction = (col === 'date' || col === 'season' ? 'asc' : 'desc'); }
        updateView();
    }

    function updateView() {
        if (currentMode === 'team') renderTeamTable();
        else { if (isTotalRankMode) renderAllRankingsTable(); else renderPlayerTable(); }
    }

    function renderTeamTable() {
        const selYear = document.getElementById('select-year').value;
        const selLoc = document.getElementById('select-location').value;
        const selMgr = document.getElementById('select-manager').value;
        const selLg = document.getElementById('select-league').value;

        let filtered = rawData.filter(m => {
            const isHome = m.hometeam && m.hometeam.includes("ë¶€ì²œ");
            const opp = isHome ? m.awayteam : m.hometeam;
            if (currentFilter.opponent && getUnifiedTeamName(opp) !== getUnifiedTeamName(currentFilter.opponent)) return false;
            if (selYear && !m.date.startsWith(selYear)) return false;
            if (selMgr && m.bfc_manager !== selMgr) return false;
            if (selLg && getUnifiedLeagueName(m.league) !== selLg) return false;
            if (selLoc && (selLoc === 'home' ? !isHome : isHome)) return false;
            return true;
        });

        document.getElementById('table-head').innerHTML = `<tr><th>ë‚ ì§œ</th><th>ëŒ€íšŒëª…</th><th>ìƒëŒ€</th><th>ì¥ì†Œ</th><th>ìŠ¤ì½”ì–´</th><th>ê²°ê³¼</th><th>ê´€ì¤‘</th><th>ê°ë…</th></tr>`;
        
        let w=0, d=0, l=0, gf=0, ga=0;
        document.getElementById('table-body').innerHTML = filtered.map(m => {
            const isHome = m.hometeam && m.hometeam.includes("ë¶€ì²œ");
            const myS = parseInt(m.homescored) || 0, opS = parseInt(m.awayscored) || 0;
            const bS = isHome ? myS : opS, oS = isHome ? opS : myS;
            gf += bS; ga += oS;
            let res = bS > oS ? "ìŠ¹" : (bS < oS ? "íŒ¨" : "ë¬´");
            if (res === "ìŠ¹") w++; else if (res === "íŒ¨") l++; else d++;
            return `<tr><td>${m.date}</td><td>${m.league}</td><td><b class="clickable" onclick="filterByOpponent('${isHome?m.awayteam:m.hometeam}')">${isHome?m.awayteam:m.hometeam}</b></td><td>${m.stadium}</td><td>${m.homescored}:${m.awayscored}</td><td class="${res==='ìŠ¹'?'win':''}">${res}</td><td>${Number(m.attendance||0).toLocaleString()}</td><td>${m.bfc_manager}</td></tr>`;
        }).join('');

        const total = filtered.length;
        document.getElementById('stat-total').innerText = total + "ê²½ê¸°";
        document.getElementById('stat-w').innerText = w + "ìŠ¹"; document.getElementById('stat-rate').innerText = total ? (((w + d * 0.5) / total) * 100).toFixed(1) + "%" : "0%";
    }

    function renderPlayerTable() {
        const year = document.getElementById('p-select-year').value;
        const nameSearch = document.getElementById('p-search-name').value;
        const selectedLeagues = Array.from(document.querySelectorAll('input[name="p-league"]:checked')).map(cb => cb.value);

        document.getElementById('table-head').innerHTML = `<tr><th>ì‹œì¦Œ</th><th>ì´ë¦„</th><th>ê²½ê¸°</th><th>ë“ì </th><th>ë„ì›€</th><th>PK</th><th>ì‹¤ì </th><th>CS</th><th>ê²½ê³ </th></tr>`;

        let filtered = playerSeasonData.filter(p => (!year || p.season === year) && (!nameSearch || p.name.includes(nameSearch)) && selectedLeagues.includes(getUnifiedLeagueName(p.league)));
        
        filtered.sort((a,b) => (sortState.direction === 'asc' ? Number(a[sortState.column]) - Number(b[sortState.column]) : Number(b[sortState.column]) - Number(a[sortState.column])));

        document.getElementById('table-body').innerHTML = filtered.map(p => `
            <tr>
                <td>${p.season}</td><td><b class="clickable" onclick="showPlayerTotal('${p.name}')">${p.name}</b></td>
                <td>${p.match}</td><td>${p.goal}</td><td>${p.assist}</td><td>${p.pk||0}</td>
                <td class="${sortState.column === 'conceded' ? 'highlight-red' : ''}">${p.conceded||0}</td>
                <td class="${sortState.column === 'cleansheet' ? 'highlight-red' : ''}">${p.cleansheet||0}</td><td>${p.yc}</td>
            </tr>`).join('');
    }

    function calculateTotalRankings() {
        const t = {};
        playerSeasonData.forEach(d => {
            if(!t[d.name]) t[d.name] = { name:d.name, match:0, goal:0, ap:0, cs:0 };
            t[d.name].match += Number(d.match||0); t[d.name].goal += Number(d.goal||0);
            t[d.name].ap += (Number(d.goal||0) + Number(d.assist||0)); t[d.name].cs += Number(d.cleansheet||0);
        });
        const r = (id, k, u) => {
            const s = Object.values(t).sort((a,b) => b[k]-a[k]).slice(0,7);
            document.getElementById(id).innerHTML = s.map((p,i) => `<div class="rank-item"><span>${i+1}. ${p.name}</span><b>${p[k].toLocaleString()}${u}</b></div>`).join('');
        };
        r('rank-match', 'match', 'ê²½ê¸°'); r('rank-goal', 'goal', 'ê³¨'); r('rank-atpoint', 'ap', 'pt'); r('rank-cs', 'cs', 'íšŒ');
    }

    function showPlayerTotal(name) {
        const pData = playerSeasonData.filter(p => p.name === name);
        const tot = { m:0, g:0, a:0, pk:0, cs:0, con:0 };
        pData.forEach(d => {
            tot.m += Number(d.match||0); tot.g += Number(d.goal||0); tot.a += Number(d.assist||0);
            tot.pk += Number(d.pk||0); tot.cs += Number(d.cleansheet||0); tot.con += Number(d.conceded||0);
        });
        document.getElementById('modal-player-name').innerText = name + " í†µì‚° ê¸°ë¡";
        document.getElementById('modal-data').innerHTML = `
            <div class="modal-item">label>ì¶œì „</label><span>${tot.m}</span></div>
            <div class="modal-item"><label>ë“ì </label><span>${tot.g}</span></div>
            <div class="modal-item"><label>ë„ì›€</label><span>${tot.a}</span></div>
            <div class="modal-item"><label>í´ë¦°ì‹œíŠ¸</label><span>${tot.cs}</span></div>
            <div class="modal-item-wide"><label>ì‹¤ì </label><span>${tot.con}ì‹¤ì </span></div>`;
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function init() {
        const now = new Date(); document.getElementById('today-date').innerText = `ì—…ë°ì´íŠ¸: ${now.toLocaleDateString()}`;
        const tY = [...new Set(rawData.map(m => m.date.substring(0,4)))].sort();
        const ySel = document.getElementById('select-year');
        tY.forEach(y => ySel.add(new Option(y + " ì‹œì¦Œ", y)));
        const mgrs = [...new Set(rawData.map(m => m.bfc_manager))].filter(Boolean).sort();
        const mSel = document.getElementById('select-manager');
        mgrs.forEach(m => mSel.add(new Option(m, m)));
        updateView();
    }
    
    function parseToNumber(v) { return Number(String(v).replace(/,/g, '')) || 0; }
    function filterByOpponent(name) { currentFilter.opponent = getUnifiedTeamName(name); updateView(); }
    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }
    function resetToAll() { location.reload(); }

    window.onload = loadData;
</script>
</body>
</html>