<header>
    <a href="javascript:void(0)" onclick="resetToAll()" class="home-link"><h1>부천FC1995 공식경기 아카이브</h1></a>
    <div id="today-date" style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;"></div>
    <div class="stats-dashboard">
        <span id="stat-total">0경기</span> | <span id="stat-w">0승</span> <span id="stat-d">0무</span> <span id="stat-l">0패</span> | 
        <span id="stat-gf">0득</span> <span id="stat-ga">0실</span> | <span id="stat-rate">0%</span>
    </div>
</header>

<div class="mode-switch">
    <button id="mode-t" class="mode-btn active" onclick="switchMode('team')">🏟️ 팀 경기 기록</button>
    <button id="mode-p" class="mode-btn" onclick="switchMode('player')">🏃‍♂️ 선수 개인 기록</button>
</div>

<div class="container">
    <div id="team-section">
        <div class="filter-container">
            <div class="filter-item"><label>시즌별</label><select id="select-year" onchange="updateView()"><option value="">전체 시즌</option></select></div>
            <div class="filter-item"><label>홈/원정</label><select id="select-location" onchange="updateView()"><option value="">전체</option><option value="home">홈 경기</option><option value="away">원정 경기</option></select></div>
            <div class="filter-item"><label>감독별</label><select id="select-manager" onchange="updateView()"><option value="">모든 감독</option></select></div>
        </div>
    </div>

    <div id="player-section" style="display: none;">
        <div class="ranking-container">
            <div class="ranking-box"><h3>🏃‍♂️ 통산 출전 TOP 7</h3><button class="more-btn" onclick="showAllRankings('match')">more</button><div id="rank-match"></div></div>
            <div class="ranking-box"><h3>⚽ 통산 득점 TOP 7</h3><button class="more-btn" onclick="showAllRankings('goal')">more</button><div id="rank-goal"></div></div>
            <div class="ranking-box"><h3>🔥 포인트 TOP 7</h3><button class="more-btn" onclick="showAllRankings('ap')">more</button><div id="rank-ap"></div></div>
            <div class="ranking-box"><h3>🧤 클린시트 TOP 7</h3><button class="more-btn" onclick="showAllRankings('cs')">more</button><div id="rank-cs"></div></div>
        </div>
        <div class="filter-container">
            <div class="filter-item"><label>시즌 선택</label><select id="p-select-year" onchange="updateView()"><option value="">전체 시즌</option></select></div>
            <div class="filter-item"><label>선수명 검색</label><input type="text" id="p-search-name" placeholder="이름 입력" onkeyup="updateView()"></div>
            <div class="filter-item" style="grid-column: span 2;">
                <label>대회 선택</label>
                <div class="checkbox-group" id="player-league-filters">
                    <label><input type="checkbox" id="check-all" checked onclick="toggleAllLeagues(this)"> 전체선택</label>
                    <label><input type="checkbox" name="p-league" value="K리그1" checked onchange="updateView()"> K리그1</label>
                    <label><input type="checkbox" name="p-league" value="K리그2" checked onchange="updateView()"> K리그2</label>
                    <label><input type="checkbox" name="p-league" value="플레이오프" checked onchange="updateView()"> 플레이오프</label>
                    <label><input type="checkbox" name="p-league" value="코리아컵" checked onchange="updateView()"> 코리아컵</label>
                </div>
            </div>
        </div>
    </div>
    
    </div>

<script>
    // [데이터 파싱 및 로딩 로직은 동일하게 유지하되 필터링 매칭 강화]
    function getUnifiedLeagueName(n) { 
        if(!n) return "";
        if(n.includes("K리그1")) return "K리그1"; 
        if(n.includes("K리그2") || n.includes("챌린지")) return "K리그2"; 
        if(n.includes("FA컵") || n.includes("코리아컵")) return "코리아컵";
        if(n.includes("플레이오프")) return "플레이오프";
        return n; 
    }

    function renderTeamTable() {
        const year = document.getElementById('select-year').value;
        const loc = document.getElementById('select-location').value;
        const mgr = document.getElementById('select-manager').value;

        let filtered = rawData.filter(m => {
            const isH = m.hometeam && m.hometeam.includes("부천");
            const opp = isH ? m.awayteam : m.hometeam;
            if (currentFilter.opponent && opp !== currentFilter.opponent) return false;
            if (currentFilter.stadium && m.stadium !== currentFilter.stadium) return false;
            if (year && !m.date.startsWith(year)) return false;
            if (mgr && m.bfc_manager !== mgr) return false;
            if (loc && (loc === 'home' ? !isH : isH)) return false;
            return true;
        });

        // [데이터가 하나도 없을 때를 대비한 안전장치]
        if (filtered.length === 0 && rawData.length > 0) {
            console.log("팀 데이터 필터링 결과가 없습니다.");
        }

        // ... (나머지 렌더링 로직은 이전과 동일하게 유지)
    }

    function renderPlayerTable() {
        const year = document.getElementById('p-select-year').value;
        const name = document.getElementById('p-search-name').value;
        // 선수 섹션의 체크박스 상태 읽기
        const selectedLeagues = Array.from(document.querySelectorAll('input[name="p-league"]:checked')).map(cb => cb.value);

        let filtered = playerSeasonData.filter(p => {
            const uniLg = getUnifiedLeagueName(p.league);
            if (!selectedLeagues.includes(uniLg)) return false;
            if (year && p.season !== year) return false;
            if (name && !p.name.includes(name)) return false;
            return true;
        });

        // ... (나머지 렌더링 로직은 이전과 동일하게 유지)
    }

    function toggleAllLeagues(master) {
        document.querySelectorAll('input[name="p-league"]').forEach(cb => cb.checked = master.checked);
        updateView();
    }
</script>
